<!DOCTYPE html>
<html lang="en">
<meta name="referrer" content="unsafe-url">
<head>
    <meta charset="UTF-8">
    <!-- meta name="referrer" content="origin" -->
    <title>Playground</title>
</head>
<body>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

<p>Servas, sag was:</p>
<aurora-button
        name="my_button"
        label="bitte drÃ¼cke mich ganz fest..."
        leading_icon="favorite"
        disabled
>
</aurora-button>

<aurora-inputtext
        name="first_name"
        aurora-name="first_name"
        label="Vorname"
        leading_icon="favorite"
        trailing_icon="fingerprint"
        placeholder="xyz"
        stack_label
        requered
        _disabled
        _readonly
>
</aurora-inputtext>

<div>
    <p>Channel: 'KVqUQIjHRjdWhTzXbys0tpWJ.channels.mytestchatgroup'</p>
    <aurora-inputtext
            id="inp-alias"
            name="alias"
            aurora-name="alias"
            label="Alias"
            placeholder="Alias"
            stack_label
            requered
    >
    </aurora-inputtext>
    <aurora-inputtext
            id="inp-pwd"
            name="pwd"
            aurora-name="pwd"
            label="Password"
            placeholder="Password"
            stack_label
            requered
    >
    </aurora-inputtext>
    <aurora-button
            id="btn-auth"
            name="signon"
            label="auth"
    >
    </aurora-button>

    <p>Messages:</p>
    <div
            id="messages">
    </div>
</div>
<script type="module" src="http://localhost:8070/embedded"></script>

<script type="module">
    window.franzi = {};
    window.channel = {};

    const setupMessages = () => {
        let $alias = document.getElementById('inp-alias');
        let $pwd   = document.getElementById('inp-pwd');
        let $auth  = document.getElementById('btn-auth');

        $auth.addEventListener('click', async () => {
            let alias = $alias.value;
            let pwd   = $pwd.value;
            if (!alias || !pwd) alert("alias und passwort eingeben");
            await universe.Identity.auth(alias, pwd);
            await universe.doAsync();
            channel = await universe.everblack.Channel.at('KVqUQIjHRjdWhTzXbys0tpWJ.channels.mytestchatgroup').join();
            if (channel) channel.onMessage((msg) => {
                let $list = document.getElementById('messages');
                let $item = document.createElement('p');
                $item.innerText = `${msg.alias} > ${msg.message}`;
                $list.appendChild($item);
            })
        })
    }

    document.addEventListener('universe.aurora', () => {
        franzi = universe.observe({ firstname: 'Franzi', lastname: 'Kwapil' });

        let vm = new universe.aurora.ViewModel();
        vm.view = document.getElementsByTagName('aurora-inputtext')[0];
        vm.model = franzi;

        // simulate a modification from somewhere
        setTimeout(() => franzi.firstname = 'Mizzi', 5000);

        setupMessages();
    });

/* possibilities to listen on aurora elements
    document.addEventListener('aurora-element-added', (evt) => {
        console.log('aurora-element-added', evt.detail);
    });

    document.addEventListener('aurora-inputtext-added', (evt) => {
        console.log('aurora-inputtext-added', evt.detail);
        console.log(evt.detail);
        console.log( evt.detail.getElementsByClassName("aurora-text-field") );
    });

    let aurorainputtext = document.getElementsByTagName('aurora-inputtext')[0];
    aurorainputtext.addEventListener('fieldtextloaded', (evt) => {
        console.log('aurora-inputtext -> fieldtextloaded', evt.detail);
    })
 */
</script>
</body>
</html>
